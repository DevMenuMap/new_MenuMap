<div class="container" style="margin-top: -20px; padding: 0;">
	<div class="row" style="margin: 0;">
		<div class="col-md-6 col-md-offset-3" style="padding: 0;">

			<% if @pictures.first.present? %>
				<%= image_tag @pictures.first.img.url, id: "rst_show_top_img" %>
			<% else %>
				<div id="rst_show_top_img">
					<%= image_tag "/images/restaurants/picture_add_icon.svg", class: "svg" %>
				</div>
			<% end %>

			<div id="rst_show_title" class="col-xs-12">
				<div class="name">
					<h1 style="font-size: 2em;"><%= @restaurant.name %></h1>
					<div>
						<p><%= @restaurant.subcategory.name %> <%= delivery_possible_with_middot(@restaurant) %></p>
					</div>
				</div>

				<div class="right">
					<div><i class="fa fa-share-alt" style="margin-right: 5px;"></i>공유</div>
					<div id="rst_show_map"><i class="fa fa-globe" style="margin-right: 5px;"></i>지도</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container" style="padding: 0;">
	<div class="row" style="margin: 0;">
		<div class="col-md-6 col-md-offset-3" style="padding: 0;">
			<div id="rst_show_tabs">
				<ul>
					<a href="#menu" role="tab" data-toggle="tab"><li><i class="fa fa-list-ul"></i><br/>메뉴</li></a>
					<a href="#comment" role="tab" data-toggle="tab"><li><i class="fa fa-commenting"></i><br/>댓글</li></a>
					<a href="#blog" role="tab" data-toggle="tab"><li><i class="fa fa-newspaper-o"></i><br/>블로그</li></a>
					<a href="#picture" role="tab" data-toggle="tab"><li><i class="fa fa-picture-o"></i><br/>사진</li></a>
					<a href="#info" role="tab" data-toggle="tab"><li><i class="fa fa-info"></i><br/>정보</li></a>
					<a id="tab_map" href="#map" role="tab" data-toggle="tab"><li style="display: none;">지도</li></a>
				</ul>
			</div>

			<div>
				<div class="tab-content">

					<!-- Map -->
					<div role="tabpanel" class="tab-pane fade" id="map">
						<div id="naver_map" style="width: 80%; height: 60%"></div>
					</div>

					<!-- Menu -->
					<div role="tabpanel" class="tab-pane fade in active" id="menu">
						<div id="menu_section" style="margin-top: -20px;">
							<ul class="col-xs-12" style="list-style: none;">
								<%= render partial: "menu_titles/show", collection: @menu_titles, as: :menu_title %>
							</ul>
						</div>

						<div id="new_menu_section">
							<%= render partial: "menus/new", locals: { menu: @menu } %>
						</div>
					</div>

					<!-- Comment -->
					<div role="tabpanel" class="tab-pane fade" id="comment">
						<div id="comment_count">
							<%= @comments.count %>
						</div> 
						<div id="comment_section">
							<%= render "comments/page" %>
						</div>

						<div id="new_comment_section">
							<%= render partial: "comments/new", locals: { comment: @comment } %>
						</div>
					</div>

					<!-- Blog -->
					<div role="tabpanel" class="tab-pane fade" id="blog">
						<div id="blog_result"></div>
					</div>

					<!-- Picture -->
					<div role="tabpanel" class="tab-pane fade" id="picture">

						<div id="carousel" class="carousel slide" data-ride="carousel" style="display: block;">
							<!-- Wrapper for slides -->
							<div class="carousel-inner" role="listbox" style="position: relative;">
								<% @pictures.each do |picture| %>
									<div class="item">
										<%= image_tag picture.img.url %>
									</div>
								<% end %>
							</div>

							<!-- Controls -->
							<a class="left carousel-control" href="#carousel" role="button" data-slide="prev">
								<span class="glyphicon glyphicon-chevron-left"></span>
							</a>
							<a class="right carousel-control" href="#carousel" role="button" data-slide="next">
								<span class="glyphicon glyphicon-chevron-right"></span>
							</a>
						</div>

						<div id="no_img" style="display: <%= no_img?(@pictures) %>;">
							<div class="row" style="margin: 0; padding: 0 15px;">
								<div class="col-xs-10 col-xs-offset-1" style="text-align: center; margin-top: 10px;">
									현재 등록된 사진이 없습니다.</br>
									사진을 등록해주세요.
								</div>
							</div>
						</div>

						<div class="row" style="margin: 0; padding: 0 15px;">
							<%= form_for @picture, html: { multipart: true, style: "margin-top: 10px;" } do |f| %>
								<%= f.hidden_field :imageable_id, value: @picture.imageable_id %>
								<%= f.hidden_field :imageable_type, value: @picture.imageable_type %>
								<%= f.file_field :img, multiple: true, class: "uploadImage" %>
								<div style="float: right;">
									<%= button_tag type: "button", class: "file_select btn btn-primary" do %>
										<i class="fa fa-plus"></i> 사진
									<% end %>
									<%= f.button "등록", class: "btn btn-primary" %>
								</div>
							<% end %>
						</div>
					</div>

					<!-- Info -->
					<div role="tabpanel" class="tab-pane fade" id="info">
						<span id="mymap_button_<%= @restaurant.id %>"><%= mymap_button(@user, @restaurant) %></span>
						<a href="tel:<%= @restaurant.phnum %>"><%= @restaurant.phnum %></a>

						<!--%= render "rest_errs/new" %-->
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<% if admin_user? %>
	<%= link_to "edit", edit_restaurant_path(@restaurant) %>
	<%= link_to "delete", restaurant_path(@restaurant), method: :delete %>
<% end %>

<%= render 'shared/modal' %>

<!-- This script is for require_from_group method -->
<script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js"></script>

<script>
	$(function(){
		$('.pagination a').attr('data-remote', 'true')
	});

	$('#update_comment').click( function(e) {
		if ( <%= current_user.nil? %> ) {
			alert("로그인 후 댓글 작성 가능합니다.");
			e.preventDefault();
		};
	});

	$(document).ready( function() {
		loadNaverMap(<%= @curr_lat %>, <%= @curr_lng %>, 9);
		showMarkers([<%= @curr_lat %>, <%= @curr_lng %>], true, ["<%= @restaurant.name %>"]);  
		toggleLabels();

		<% if @restaurant.with_latlng? %>
			parseFoursquareImg("<%= request.url %>");
		<% elsif @pictures.blank? %>
			$("#carousel").css("display", "none");
		<% end %>

		imageUploadValidate();

		$.ajax({
			url: '/blogs/blog_ajax',
			data: {
				id: <%= @restaurant.id %>
			}
		});

		$("#new_rest_err").validate({
			rules: {
				'rest_err[presence_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[menu_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[phnum_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[category_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[etc]': { require_from_group: [1, ".rest_errs_group"] }
			}
		});

		$("#menu_section ul li:first-child a > div").click();

		$(".menu").click(function(){
			$.ajax({
				url: '/comments/show',
				data: {
					menu_id: $(this).data('menu-id')
				}
			});
		});
	});
</script>
