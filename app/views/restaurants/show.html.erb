<div class="container" style="margin-top: -20px; padding: 0;">
	<div class="row" style="margin: 0;">
		<div class="col-md-6 col-md-offset-3" style="padding: 0;">

			<% if @main_img %>
				<%= image_tag @main_img.img.url, id: "rst_show_top_img" %>
			<% else %>
				<div id="rst_show_top_img">
					<%= image_tag "/images/restaurants/picture_add_icon.svg", class: "svg" %>
				</div>
			<% end %>

			<div id="rst_show_title">
				<div class="name">
					<h1 style="font-size: 2em;"><%= @restaurant.name %></h1>
					<div>
						<p><%= @restaurant.subcategory.name %> <%= delivery_possible_with_middot(@restaurant) %></p>
					</div>
				</div>

				<div class="right">
					<div><i class="fa fa-share-alt"></i> 공유</div>
					<div onclick="$('#tab_map').click();"><i class="fa fa-globe"></i> 지도</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container" style="padding: 0;">
	<div class="row" style="margin: 0;">
		<div class="col-md-6 col-md-offset-3" style="padding: 0;">
			<div id="rst_show_tabs">
				<ul>
					<li><a href="#menu" role="tab" data-toggle="tab" style="color: initial;"><i class="fa fa-list-ul"></i></a></li>
					<li><a href="#comment" role="tab" data-toggle="tab" style="color: initial;"><i class="fa fa-comment-o"></i></a></li>
					<li><a href="#blog" role="tab" data-toggle="tab" style="color: initial;"><i class="fa fa-newspaper-o"></i></a></li>
					<li><a href="#picture" role="tab" data-toggle="tab" style="color: initial;"><i class="fa fa-picture-o"></i></a></li>
					<li><a href="#info" role="tab" data-toggle="tab" style="color: initial;"><i class="fa fa-info"></i></a></li>
					<li style="display: none;"><a id="tab_map" href="#map" role="tab" data-toggle="tab" style="color: initial;">지도</a></li>
				</ul>
			</div>

			<div>
				<div class="tab-content">

					<!-- Map -->
					<div role="tabpanel" class="tab-pane fade" id="map">
						<div id="naver_map" style="width: 80%; height: 60%"></div>
					</div>

					<!-- Menu -->
					<div role="tabpanel" class="tab-pane fade in active" id="menu">
						<div id="menu_section">
							<!-- Collection can pass each related menu_title with :as -->
							<%= render partial: "menu_titles/show", collection: @menu_titles, as: :menu_title %>
						</div>

						<div id="new_menu_section">
							<%= render partial: "menus/new", locals: { menu: @menu } %>
						</div>
					</div>

					<!-- Comment -->
					<div role="tabpanel" class="tab-pane fade" id="comment">
						<div id="comment_count">
							<%= @comments.count %>
						</div> 
						<div id="comment_section">
							<%= render "comments/page" %>
						</div>

						<div id="new_comment_section">
							<%= render partial: "comments/new", locals: { comment: @comment } %>
						</div>
					</div>

					<!-- Blog -->
					<div role="tabpanel" class="tab-pane fade" id="blog">
						<div id="blog_result"></div>
					</div>

					<!-- Picture -->
					<div role="tabpanel" class="tab-pane fade" id="picture">
						<%= form_for @picture, html: { multipart: true } do |f| %>
							<%= f.hidden_field :imageable_id, value: @picture.imageable_id %>
							<%= f.hidden_field :imageable_type, value: @picture.imageable_type %>

							<%= render "pictures/field", f: f %>

							<%= f.submit %>
						<% end %>
					</div>

					<!-- Info -->
					<div role="tabpanel" class="tab-pane fade" id="info">
						<span id="mymap_button_<%= @restaurant.id %>"><%= mymap_button(@user, @restaurant) %></span>
						<a href="tel:<%= @restaurant.phnum %>"><%= @restaurant.phnum %></a>

						<!--%= render "rest_errs/new" %-->
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<% if admin_user? %>
	<%= link_to "edit", edit_restaurant_path(@restaurant) %>
	<%= link_to "delete", restaurant_path(@restaurant), method: :delete %>
<% end %>

<%= render 'shared/modal' %>


<!-- This script is for require_from_group method -->
<script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js"></script>
<script>
	$(function(){
		$('.pagination a').attr('data-remote', 'true')
	});

	$(document).ready( function() {
		loadNaverMap(<%= @curr_lat %>, <%= @curr_lng %>, 9);
		showMarkers([<%= @curr_lat %>, <%= @curr_lng %>], true, ["<%= @restaurant.name %>"]);  
		toggleLabels();
	
		<% if @restaurant.with_latlng? %>
			parseFoursquareImg("<%= request.url %>");
		<% end %>

		$("#new_rest_err").validate({
			rules: {
				'rest_err[presence_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[menu_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[phnum_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[category_err]': { require_from_group: [1, ".rest_errs_group"] },
				'rest_err[etc]': { require_from_group: [1, ".rest_errs_group"] }
			}
		});
		$('#new_menu').validate({
			rules: {
				'menu[name]': { required: true }
			}
		});
		$('#new_comment').validate({
			rules: {
				'comment[contents]': { required: true }
			}
		});
		$("#new_rest_register").validate();
		imageUploadValidate();

		slangCheck("#new_comment", "#comment_contents");
		
		$('#comment_contents').bind("paste", function(e) {
			alert("붙여넣기는 금지되어 있습니다.");
			e.preventDefault(); 
		});
		$('#update_comment').click( function(event) {
			if ( <%= current_user.nil? %> ) {
				alert("로그인 후 댓글 작성 가능합니다.");
				event.preventDefault();
			};
		});

		$.ajax({
			url: '/blogs/blog_ajax',
			data: {
				id: <%= @restaurant.id %>
			}
		});
	});
</script>
